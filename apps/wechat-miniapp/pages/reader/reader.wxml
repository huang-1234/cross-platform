<!--pages/reader/reader.wxml-->
<view class="reader-page {{isDarkMode ? 'dark-mode' : ''}}" bindtap="handleScreenTap">
  <scroll-view
    scroll-y
    class="reader-content"
    bindscroll="handleScroll"
    scroll-with-animation
    bindlongpress="handleLongPress"
  >
    <view class="chapter-title">
      <text>{{currentChapter.title}}</text>
    </view>

    <rich-text class="chapter-content" style="font-size: {{fontSize}}px;" nodes="{{contentWithHighlights}}"></rich-text>

    <!-- åº•éƒ¨ç©ºç™½ï¼Œé˜²æ­¢å†…å®¹è¢«åº•éƒ¨èœå•é®æŒ¡ -->
    <view style="height: 100rpx;"></view>
  </scroll-view>

  <!-- é«˜äº®èœå• -->
  <view class="highlight-menu" wx:if="{{showHighlightMenu}}" style="left: {{highlightMenuPosition.x}}px; top: {{highlightMenuPosition.y}}px;">
    <view class="menu-content">
      <view class="color-options">
        <view class="color-option" style="background-color: #ffeb3b;" bindtap="handleCreateHighlight" data-color="#ffeb3b"></view>
        <view class="color-option" style="background-color: #a5d6a7;" bindtap="handleCreateHighlight" data-color="#a5d6a7"></view>
        <view class="color-option" style="background-color: #90caf9;" bindtap="handleCreateHighlight" data-color="#90caf9"></view>
        <view class="color-option" style="background-color: #ef9a9a;" bindtap="handleCreateHighlight" data-color="#ef9a9a"></view>
      </view>

      <view class="menu-item" bindtap="handleCreateHighlight">é«˜äº®</view>
      <view class="menu-item" bindtap="closeHighlightMenu">å–æ¶ˆ</view>
    </view>
    <view class="arrow"></view>
  </view>

  <!-- åº•éƒ¨èœå• -->
  <view class="reader-bottom-menu" wx:if="{{showMenu}}">
    <view class="menu-item" bindtap="handleBackToBookshelf">
      <text class="menu-icon">ğŸ“š</text>
      <text class="menu-text">ä¹¦æ¶</text>
    </view>

    <view class="menu-item" bindtap="handleShowChapters">
      <text class="menu-icon">ğŸ“‘</text>
      <text class="menu-text">ç›®å½•</text>
    </view>

    <view class="menu-item" bindtap="handleFontSizeChange" data-type="decrease">
      <text class="menu-icon">A-</text>
      <text class="menu-text">ç¼©å°</text>
    </view>

    <view class="menu-item" bindtap="handleFontSizeChange" data-type="increase">
      <text class="menu-icon">A+</text>
      <text class="menu-text">æ”¾å¤§</text>
    </view>

    <view class="menu-item" bindtap="handleThemeChange">
      <text class="menu-icon">ğŸŒ“</text>
      <text class="menu-text">ä¸»é¢˜</text>
    </view>
  </view>

  <!-- è¯„è®ºé¢æ¿ -->
  <comment-panel
    wx:if="{{activeHighlightId}}"
    highlight-id="{{activeHighlightId}}"
    bind:close="closeCommentPanel"
  ></comment-panel>
</view>
